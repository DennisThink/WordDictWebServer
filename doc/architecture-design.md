# WordDictWebServer的架构设计

在服务程序开发领域，我们经常提到的一个词叫做主备。在软件的设计过程中，我认为应该在关键节点保留比较好的接口设计，以方便进行所使用库的替换和更新。那么下面我就来介绍一下我在WordDictWebServer中是如何进行设计的。

WordDictWebServer是一个提供英文单词翻译为中文的服务，作为一个翻译软件，如何设计好的字典接口，就是一件重要的事情了。在字典的设计上，我给字典设计了接口类，提供最基础的配置文件设置和翻译功能函数。在具体的实现上，用Mysql，Sqlite和Json作为三个具体的字典实现，实现了通过网络和SQL查询进行翻译，通过本地SQL查询进行翻译，和本地自定义查询算法进行翻译三个功能。这样的设计在后续也方便增加例如Oracle或者MS SQLSERVER作为数据存储。为了记录每个用户的已知单词和未知单词，以便更好的提供翻译服务，我将字典的数据读写和用户相关的数据读写分别放在两个类中来实现，这样对于用户数据相关的改动就不会影响的字典数据库的改动。而且如果开发本地的翻译服务，SQLite和JSON的字典都可以承担本地翻译的功能，并且可以相互替换，方便客户端软件的开发。

WordDictWebServer也提供HTTP的接口进行翻译服务，因为HTTP本身是一种文本协议，所以可以有多个库来进行HTTP协议的解析。在此处我设计了使用ASIO网络库的HTTP接口类CAsioHttpServer和不提供异步功能的CCppHttpServer两个类来实现HTTP接口服务。在接口的设计上将不同类的HTTP请求和HTTP回复进行区分，在基类中设计参数和返回值都是string的函数进行实际的运算处理。这样的设计，也可以在不使用网络连接的基础上，对接口的部分功能进行测试。

使用DOCTEST进行测试，对于代码重构来说，拥有完善的测试，是一件非常好的事情。我在美洽看到了测试代码的好处，所以在设计软件的时候，尽量的将接口设计为可以测试的。整个软件的函数应该有30%左右有测试代码，在代码测试这个方面，我还需要继续努力，要不测试覆盖率都讲不清楚。

这就是我一个半月的努力成果，感谢您的阅读。